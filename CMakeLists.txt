cmake_minimum_required(VERSION 2.8.13)

project(DungeonDave)

# So that editors can use info generated by CMake.
set(CMAKE_EXPORT_COMPILE_COMMANDS "ON")

########## Setting the C standard, warning flags, and debug/release flags.

set(CMAKE_C_STANDARD 99)
set(CMAKE_C_STANDARD_REQUIRED TRUE)

set(CONVERSION_WARNINGS_1 "-Wfloat-conversion -Wimplicit-float-conversion -Wdouble-promotion -Wsign-conversion")
set(CONVERSION_WARNINGS_2 "-Wimplicit-int-conversion -Wshorten-64-to-32 -Wincompatible-pointer-types")
set(CMAKE_C_FLAGS "-Wall -Wextra -Wpedantic -Wformat ${CONVERSION_WARNINGS_1} ${CONVERSION_WARNINGS_2}")

set(CMAKE_C_FLAGS_DEBUG "-g -fsanitize=address,undefined,float-divide-by-zero,unsigned-integer-overflow,implicit-conversion")
set(CMAKE_C_FLAGS_RELEASE "-Ofast")

########## Declaring SDL2 as a package, and other standard CMake boilerplate.

find_package(SDL2 REQUIRED)
file(GLOB_RECURSE SRC_FILES src/*.c lib/glad.c lib/cjson.c)

add_executable(dungeon_dave ${SRC_FILES})
target_include_directories(dungeon_dave PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/include ${CMAKE_CURRENT_SOURCE_DIR}/lib ${SDL2_INCLUDE_DIRS})

# TODO: make the .dylib thing portable to more systems
target_link_libraries(dungeon_dave ${CMAKE_CURRENT_SOURCE_DIR}/lib/openal/libopenal.dylib ${SDL2_LIBRARIES})

##########
